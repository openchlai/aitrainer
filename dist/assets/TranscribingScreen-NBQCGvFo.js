import{_ as F,u as z,r as i,g as G,x as k,f as y,c as g,a as e,t as c,p as B,y as H,w as J,v as O,C as Q,b as x,l as R,A as W,q as I,o as w,s as T}from"./index-DO2i8zK8.js";const X={class:"transcription-screen"},Z={class:"top-bar"},ee={class:"narration"},te={class:"audio-container"},ne=["src"],ae={class:"playback-buttons"},se=["disabled"],oe=["disabled"],ie={class:"current-time"},ue={class:"transcription-box"},re=["onKeydown"],le={class:"action-buttons"},ce=["disabled"],de=["disabled"],ve=["disabled"],fe={class:"modal"},pe={class:"modal"},j="http://127.0.0.1:8000",_e={__name:"TranscribingScreen",setup(be){const f=z(),N=W(),o=i(0),s=i(null),r=i(!1),h=i(0),m=N.params.listType,u=i(""),d=i(!1),v=i(!1),l=i(null);G(()=>{const t=parseInt(N.params.startIndex,10);o.value=Number.isNaN(t)?0:t});const p=k(()=>m==="not-transcribed"?f.notTranscribed:m==="transcribed"?f.transcribed:m==="rejected"?f.rejected:[]),a=k(()=>p.value[o.value]||{}),S=k(()=>p.value.length);console.log("Current chunk:",a.value),console.log("ActiveList:",p.value.length),u.value=a.value.true_transcription||"";const D=k(()=>a.value.chunk_file?`${j}${a.value.chunk_file}`:"");y(a,async()=>{u.value=a.value.true_transcription||"",r.value=!1,h.value=0,await T(),s.value&&s.value.load()}),y(s,t=>{t&&(t.ontimeupdate=()=>{h.value=t.currentTime},t.onplay=()=>{r.value=!0},t.onpause=()=>{r.value=!1})});function E(){s.value&&s.value.play()}function M(){s.value&&s.value.pause()}function K(){s.value&&(s.value.currentTime=0,r.value=!1,s.value.pause())}function A(t){if(!s.value)return;const n=s.value.currentTime+t,b=s.value.duration||0;s.value.currentTime=Math.min(Math.max(n,0),b)}y(d,async t=>{t&&(await T(),l.value&&l.value.focus())}),y(v,async t=>{t&&(await T(),l.value&&l.value.focus())});async function P(){if(a.value.id)try{const t={true_transcription:u.value,is_rejected:!1},n=await I.post(`${j}/api/transcription/api/chunks/${a.value.id}/update-transcription/`,t);console.log(n.data.message),a.value.true_transcription=u.value,a.value.is_rejected=!1,alert("Transcription saved successfully!")}catch(t){console.error("Error saving transcription:",t),alert("Could not save transcription.")}}async function V(){if(a.value.id)try{const t=await I.post(`${j}/api/transcription/api/chunks/${a.value.id}/update-rejection/`,{is_rejected:!0});console.log(t.data.message),a.value.is_rejected=!0,v.value=!1,alert("Chunk rejected successfully.")}catch(t){console.error("Error rejecting chunk:",t),alert("Could not reject chunk.")}}function $(){o.value<p.value.length-1&&o.value++}function L(){o.value>0&&o.value--}function Y(){v.value=!0}function U(){u.value.trim()&&(d.value=!0)}async function q(){d.value=!1,await P(),$()}function _(){d.value=!1,v.value=!1}return(t,n)=>{var b;return w(),g("div",X,[e("div",Z,[e("p",null,c(o.value+1)+" / "+c(S.value),1),e("h2",null," Transcribing chunk_"+c(a.value.order),1),e("p",ee,[n[3]||(n[3]=e("strong",null,"Narrative:",-1)),B(" "+c((b=H(f).selectedCase)==null?void 0:b.narrative),1)])]),e("div",te,[e("audio",{ref_key:"audioPlayer",ref:s,class:"audio-player",controls:""},[e("source",{src:D.value,type:"audio/wav"},null,8,ne),n[4]||(n[4]=B(" Your browser does not support the audio element. "))],512),e("div",ae,[e("button",{onClick:E,disabled:r.value},"Play",8,se),e("button",{onClick:M,disabled:!r.value},"Pause",8,oe),e("button",{onClick:K},"Reset"),e("button",{onClick:n[0]||(n[0]=C=>A(-5))},"-5s"),e("button",{onClick:n[1]||(n[1]=C=>A(5))},"+5s")]),e("div",ie," Time: "+c(h.value.toFixed(2))+"s / "+c(a.value.duration||0)+"s ",1)]),e("div",ue,[n[5]||(n[5]=e("label",{for:"transcription"},"Transcription:",-1)),J(e("textarea",{id:"transcription",ref:"transcriptionInput","onUpdate:modelValue":n[2]||(n[2]=C=>u.value=C),rows:"5",onKeydown:Q(x(U,["prevent"]),["enter"])},null,40,re),[[O,u.value]])]),e("div",le,[e("button",{onClick:L,disabled:o.value===0}," Previous ",8,ce),e("button",{onClick:Y,disabled:a.value.is_rejected===!0,class:"reject-button"}," Reject ",8,de),e("button",{onClick:P,class:"save-button"}," Save "),e("button",{onClick:$,disabled:o.value===S.value-1}," Next ",8,ve)]),d.value?(w(),g("div",{key:0,class:"modal-overlay",onClick:x(_,["self"])},[e("div",fe,[n[6]||(n[6]=e("p",null,"Save and go next?",-1)),e("div",null,[e("button",{onClick:_},"Cancel"),e("button",{ref_key:"yesButton",ref:l,onClick:q},"Yes",512)])])])):R("",!0),v.value?(w(),g("div",{key:1,class:"modal-overlay",onClick:x(_,["self"])},[e("div",pe,[n[7]||(n[7]=e("p",null,"Reject this chunk?",-1)),e("div",null,[e("button",{onClick:_},"Cancel"),e("button",{ref_key:"yesButton",ref:l,onClick:V},"Yes",512)])])])):R("",!0)])}}},ye=F(_e,[["__scopeId","data-v-85408366"]]);export{ye as default};
