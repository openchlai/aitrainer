import{s as a}from"./index-DJOWaoZy.js";const o=a.create({baseURL:"http://127.0.0.1:8000/api",headers:{"Content-Type":"application/json"}});let s=!1,n=[];const i=e=>{n.push(e)},u=e=>{n.forEach(r=>r(e)),n=[]},h=async()=>{try{const e=localStorage.getItem("refresh_token");if(!e)throw new Error("No refresh token found.");const t=(await a.post("http://127.0.0.1:8000/api/token/refresh/",{refresh:e})).data.access;return localStorage.setItem("access_token",t),u(t),t}catch(e){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",Promise.reject(e)}};o.interceptors.request.use(e=>{const r=localStorage.getItem("access_token"),t=e.url.includes("/login")||e.url.includes("/register");return r&&!t&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));o.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.response&&e.response.status===401&&!r._retry){if(s)return new Promise(t=>{i(c=>{r.headers.Authorization=`Bearer ${c}`,t(o(r))})});r._retry=!0,s=!0;try{const t=await h();return s=!1,r.headers.Authorization=`Bearer ${t}`,o(r)}catch(t){return s=!1,Promise.reject(t)}}return Promise.reject(e)});export{o as a};
