import{s as a}from"./index-B0RH2Ixy.js";const c=()=>window.location.hostname==="aitrainer.bitz-itc.com"?"https://edms-enpoints.bitz-itc.com/":"http://127.0.0.1:8000/api",o=a.create({baseURL:c(),headers:{"Content-Type":"application/json"}});let s=!1,n=[];const u=e=>{n.push(e)},h=e=>{n.forEach(r=>r(e)),n=[]},l=async()=>{try{const e=localStorage.getItem("refresh_token");if(!e)throw new Error("No refresh token found.");const t=(await a.post(`${c()}token/refresh/`,{refresh:e})).data.access;return localStorage.setItem("access_token",t),h(t),t}catch(e){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",Promise.reject(e)}};o.interceptors.request.use(e=>{const r=localStorage.getItem("access_token"),t=e.url.includes("/login")||e.url.includes("/register");return r&&!t&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));o.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.response&&e.response.status===401&&!r._retry){if(s)return new Promise(t=>{u(i=>{r.headers.Authorization=`Bearer ${i}`,t(o(r))})});r._retry=!0,s=!0;try{const t=await l();return s=!1,r.headers.Authorization=`Bearer ${t}`,o(r)}catch(t){return s=!1,Promise.reject(t)}}return Promise.reject(e)});export{o as a};
